#!/bin/sh
#-------------------------------------------------------------------------------------# 
# PURPOSE: run Cx
#-------------------------------------------------------------------------------------# 

# source the ciop functions (e.g. ciop-log)
source ${ciop_job_include}

bash /application/bin/ini.sh

export DIR=~/data/ISD/ISD000/
if [ ! -d "$DIR" ]; then
    mkdir $DIR
fi

export -p CXDIR=~/wp07-di/src/main/app-resources/bin/ISD100_CxDx/bin/

#-------------------------------------------------------------------------------------# 
fcx(){
aoi=$(cat $DIR/AOI.txt ); echo "$aoi" 
years=$(awk '{print $1, $2}' $DIR/AOI.txt)
exec $CXDIR"climatic_dataset_000001.sh" $aoi &
wait 
exec $CXDIR"climatic_dataset_001001.sh" $years &
exec $CXDIR"climatic_dataset_002001.sh" $years &
wait
exec $CXDIR"climatic_dataset_001002.sh" &
exec $CXDIR"climatic_dataset_002002.sh"   
}
#-------------------------------------------------------------------------------------# 
while IFS='' read -r line || [[ -n "$line" ]]; do
	if [[ "$line" == AOI1 ]] ; then
		echo "${AOI1=$(echo 1985 2010 44.25 -9.75 36.75 3.00 0.75)}" >$DIR/AOI.txt
		fcx
	elif [[ "$line" == AOI2 ]] ; then
		echo "${AOI2=$(echo 1985 2010 37.5 -19.0 12.0 25.5 0.75)}" >$DIR/AOI.txt
		fcx
	elif [[ "$line" == AOI3 ]] ; then
		echo "${AOI3=$(echo 1985 2010 -9.0 21.0 -31.5 41.0 0.75)}" >$DIR/AOI.txt
		fcx
	elif [[ "$line" == AOI4 ]] ; then
		echo "${AOI4=$(echo 1985 2010 42.5 25.5 36.0 45.0 0.75)}" >$DIR/AOI.txt
		fcx
	else
		echo "AOI out of range"
	fi 
done < "$1"
#done < $inputfile
#-------------------------------------------------------------------------------------# 
exit 0 